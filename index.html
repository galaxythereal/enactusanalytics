<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enactus Menoufia Advanced Analytics Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #4f46e5, #0ea5e9);
        }

        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .glassmorphism {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <header class="gradient-bg text-white py-6">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">Enactus Menoufia</h1>
                    <p class="text-lg">Advanced Analytics Hub</p>
                </div>
                <div class="flex space-x-4">
                    <button id="exportBtn" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50 transition duration-300 flex items-center">
                        <i class="fas fa-download mr-2"></i>Export Report
                    </button>
                    <button id="refreshBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300 flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <section class="mb-8">
            <div class="glassmorphism p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Analytics Filters</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div>
                        <label for="committeeFilter" class="block text-sm font-medium text-gray-700 mb-1">Committee</label>
                        <select id="committeeFilter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Committees</option>
                        </select>
                    </div>
                    <div>
                        <label for="facultyFilter" class="block text-sm font-medium text-gray-700 mb-1">Faculty</label>
                        <select id="facultyFilter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Faculties</option>
                        </select>
                    </div>
                    <div>
                        <label for="yearFilter" class="block text-sm font-medium text-gray-700 mb-1">Academic Year</label>
                        <select id="yearFilter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    <div>
                        <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                        <input type="text" id="searchInput" placeholder="Search applicants..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>
        </section>
<div class="card p-6">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Gender Distribution</h3>
    <div class="chart-container">
        <canvas id="genderChart"></canvas>
    </div>
</div>
<div class="card p-6">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Academic Year Distribution</h3>
    <div class="chart-container">
        <canvas id="yearChart"></canvas>
    </div>
</div>
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="card p-6">
                <div class="flex items-center">
                    <div class="bg-blue-500 rounded-full p-3 mr-4">
                        <i class="fas fa-users text-white text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Total Applicants</p>
                        <h3 class="text-2xl font-bold text-gray-900" id="totalApplicants">0</h3>
                        <span class="text-green-500 text-sm" id="applicantChange">+0%</span>
                    </div>
                </div>
            </div>
            <div class="card p-6">
                <div class="flex items-center">
                    <div class="bg-green-500 rounded-full p-3 mr-4">
                        <i class="fas fa-venus-mars text-white text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Gender Ratio</p>
                        <h3 class="text-2xl font-bold text-gray-900" id="genderRatio">0:0</h3>
                        <span class="text-blue-500 text-sm">Male : Female</span>
                    </div>
                </div>
            </div>
            <div class="card p-6">
                <div class="flex items-center">
                    <div class="bg-purple-500 rounded-full p-3 mr-4">
                        <i class="fas fa-graduation-cap text-white text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Top Faculty</p>
                        <h3 class="text-2xl font-bold text-gray-900" id="topFaculty">-</h3>
                        <span class="text-purple-500 text-sm" id="topFacultyPercentage">0%</span>
                    </div>
                </div>
            </div>
            <div class="card p-6">
                <div class="flex items-center">
                    <div class="bg-yellow-500 rounded-full p-3 mr-4">
                        <i class="fas fa-chart-pie text-white text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Popular Committee</p>
                        <h3 class="text-2xl font-bold text-gray-900" id="popularCommittee">-</h3>
                        <span class="text-yellow-500 text-sm" id="popularCommitteePercentage">0%</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="card p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Application Timeline</h3>
                <div class="chart-container">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
            <div class="card p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Committee Distribution</h3>
                <div class="chart-container">
                    <canvas id="committeeChart"></canvas>
                </div>
            </div>
        </section>
<section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="card p-6">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Faculty Distribution</h3>
        <div class="chart-container">
            <canvas id="facultyChart"></canvas>
        </div>
    </div>
</section>
        <section class="card overflow-hidden">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">Applicants List</h3>
                <div class="flex space-x-2">
                    <button id="filterToggle" class="bg-blue-100 text-blue-800 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors">
                        <i class="fas fa-filter mr-2"></i>Toggle Filters
                    </button>
                    <button id="exportTable" class="bg-green-100 text-green-800 px-4 py-2 rounded-lg hover:bg-green-200 transition-colors">
                        <i class="fas fa-download mr-2"></i>Export Table
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Committee</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Faculty</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="applicantsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Table rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
            <div class="p-4 flex items-center justify-between border-t border-gray-200">
                <div>
                    <p class="text-sm text-gray-700">
                        Showing <span id="startRange" class="font-medium">1</span> to <span id="endRange" class="font-medium">10</span> of <span id="totalEntries" class="font-medium">0</span> entries
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        <button id="prevPage" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Previous</span>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="nextPage" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Next</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </nav>
                </div>
            </div>
        </section>
    </main>

    <div id="applicantModal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                Applicant Profile
                            </h3>
                            <div class="mt-2">
                                <div id="modalContent">
                                    <!-- Dynamic content for applicant profile -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="closeModal" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    let applicants = [];
    let filteredApplicants = [];
    let currentPage = 1;
    const itemsPerPage = 10;
// Chart instances
    const filters = {
        committee: '',
        faculty: '',
        year: '',
        search: ''
    };

    // DOM elements
    const totalApplicantsEl = document.getElementById('totalApplicants');
    const genderRatioEl = document.getElementById('genderRatio');
    const topFacultyEl = document.getElementById('topFaculty');
    const popularCommitteeEl = document.getElementById('popularCommittee');
    const startRangeEl = document.getElementById('startRange');
    const endRangeEl = document.getElementById('endRange');
    const totalEntriesEl = document.getElementById('totalEntries');
    const applicantModal = document.getElementById('applicantModal');
    const modalContentEl = document.getElementById('modalContent');
    const loadingOverlay = document.getElementById('loading-overlay');

    

    // Fetch data from Google Apps Script
async function fetchData() {
    loadingOverlay.style.display = 'flex';
    try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbz9qFKlJQ9AxBzUNE-ZrXbG_q92r-kjVBDb3D8u3HN7g-Aq7iD64KL6zkIxgimEQA/exec');
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const text = await response.text();
        console.log('Response text:', text);
        
        const data = JSON.parse(text);
        
        if (data.status === "error") {
            throw new Error(data.message);
        }
        
        applicants = data.data.map(row => ({
    id: row['Timestamp'],
    firstName: row['firstName'] || '',
    lastName: row['lastName'] || '',
    preferredCommittee: row['preferredCommittee'] || '',
    gender: row['gender'] || '',
    faculty: row['faculty'] || '',
    otherFaculty: row['otherFaculty'] || '',
    phone: row['phone'] || '',
    academicYear: row['academicYear'] || '',
    email: row['email'] || '',
    skills: row['skills'] || '',
    experience: row['experience'] || '',
    dob: row['dob'] || '',
    facebook: row['facebook'] || '',
    linkedin: row['linkedin'] || '',
    portfolio: row['portfolio'] || '',
    Timestamp: row['Timestamp'] || '',
    projectsQ1: row['projectsQ1'] || '',
    projectsQ2: row['projectsQ2'] || '',
    projectsQ3: row['projectsQ3'] || '',
    logisticsQ1: row['logisticsQ1'] || '',
    logisticsQ2: row['logisticsQ2'] || '',
    logisticsQ3: row['logisticsQ3'] || '',
    presentationQ1: row['presentationQ1'] || '',
    presentationQ2: row['presentationQ2'] || '',
    presentationQ3: row['presentationQ3'] || '',
    graphicDesignQ1: row['graphicDesignQ1'] || '',
    graphicDesignQ2: row['graphicDesignQ2'] || '',
    graphicDesignQ3: row['graphicDesignQ3'] || '',
    videoPhotoQ1: row['videoPhotoQ1'] || '',
    videoPhotoQ2: row['videoPhotoQ2'] || '',
    videoPhotoQ3: row['videoPhotoQ3'] || '',
    hrQ1: row['hrQ1'] || '',
    hrQ2: row['hrQ2'] || '',
    hrQ3: row['hrQ3'] || '',
    prFrQ1: row['prFrQ1'] || '',
    prFrQ2: row['prFrQ2'] || '',
    prFrQ3: row['prFrQ3'] || '',
    digitalMarketingQ1: row['digitalMarketingQ1'] || '',
    digitalMarketingQ2: row['digitalMarketingQ2'] || '',
    digitalMarketingQ3: row['digitalMarketingQ3'] || ''
}));
        
        console.log('Processed applicants:', applicants);
        
        stats = data.stats;
        console.log('Stats:', stats);
        
        initializeDashboard();
    } catch (error) {
        console.error('Error fetching data:', error);
        alert('Failed to fetch data. Please try again later.');
    } finally {
        loadingOverlay.style.display = 'none';
    }
}
    function initializeDashboard() {
        updateFilters();
        initializeCharts();
        updateDashboard();
            attachEventListeners();
    }

    function updateFilters() {
        const committees = [...new Set(applicants.map(a => a.committee))];
        const faculties = [...new Set(applicants.map(a => a.faculty))];
        const years = [...new Set(applicants.map(a => a.year))];

        populateSelect('committeeFilter', committees);
        populateSelect('facultyFilter', faculties);
        populateSelect('yearFilter', years);
    }

    function populateSelect(id, options) {
        const select = document.getElementById(id);
        select.innerHTML = '<option value="">All</option>';
        options.forEach(option => {
            const optionEl = document.createElement('option');
            optionEl.value = option;
            optionEl.textContent = option;
            select.appendChild(optionEl);
        });
    }

    function updateDashboard() {
        applyFilters();
        updateStats();
        renderTable();
        updateCharts();
    }

    function applyFilters() {
        filteredApplicants = applicants.filter(applicant => {
            return (filters.committee ? applicant.committee === filters.committee : true) &&
                   (filters.faculty ? applicant.faculty === filters.faculty : true) &&
                   (filters.year ? applicant.year === filters.year : true) &&
                   (filters.search ? applicant.name.toLowerCase().includes(filters.search.toLowerCase()) : true);
        });
    }

  function updateStats() {
        const totalApplicants = filteredApplicants.length;
    totalApplicantsEl.textContent = totalApplicants;

    const genderCounts = filteredApplicants.reduce((acc, applicant) => {
        acc[applicant.gender] = (acc[applicant.gender] || 0) + 1;
        return acc;
    }, {});
    const maleCount = genderCounts['Male'] || 0;
    const femaleCount = genderCounts['Female'] || 0;
    genderRatioEl.textContent = `${maleCount}:${femaleCount}`;

    const facultyCounts = filteredApplicants.reduce((acc, applicant) => {
        acc[applicant.faculty] = (acc[applicant.faculty] || 0) + 1;
        return acc;
    }, {});
    const topFaculty = Object.entries(facultyCounts).sort((a, b) => b[1] - a[1])[0];
    topFacultyEl.textContent = topFaculty ? topFaculty[0] : '-';
    document.getElementById('topFacultyPercentage').textContent = topFaculty ? `${((topFaculty[1] / totalApplicants) * 100).toFixed(1)}%` : '0%';

    const committeeCounts = filteredApplicants.reduce((acc, applicant) => {
        acc[applicant.committee] = (acc[applicant.committee] || 0) + 1;
        return acc;
    }, {});
    const popularCommittee = Object.entries(committeeCounts).sort((a, b) => b[1] - a[1])[0];
    popularCommitteeEl.textContent = popularCommittee ? popularCommittee[0] : '-';
    document.getElementById('popularCommitteePercentage').textContent = popularCommittee ? `${((popularCommittee[1] / totalApplicants) * 100).toFixed(1)}%` : '0%';
}

    function renderTable() {
        const tbody = document.getElementById('applicantsTableBody');
        tbody.innerHTML = '';

        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageApplicants = filteredApplicants.slice(start, end);

        pageApplicants.forEach(applicant => {
        const row = `
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">${applicant.name}</td>
                <td class="px-6 py-4 whitespace-nowrap">${applicant.committee}</td>
                <td class="px-6 py-4 whitespace-nowrap">${applicant.faculty}</td>
                <td class="px-6 py-4 whitespace-nowrap">${applicant.year}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-${getStatusColor(applicant.status)}-100 text-${getStatusColor(applicant.status)}-800">
                        ${applicant.status}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="viewProfile('${applicant.id}')" class="text-indigo-600 hover:text-indigo-900">View Profile</button>
                </td>
            </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
    });

        updatePagination();
    }

    function getStatusColor(status) {
        switch (status.toLowerCase()) {
            case 'accepted': return 'green';
            case 'pending': return 'yellow';
            case 'rejected': return 'red';
            default: return 'gray';
        }
    }

    function updatePagination() {
        const totalPages = Math.ceil(filteredApplicants.length / itemsPerPage);
        startRangeEl.textContent = ((currentPage - 1) * itemsPerPage) + 1;
        endRangeEl.textContent = Math.min(currentPage * itemsPerPage, filteredApplicants.length);
        totalEntriesEl.textContent = filteredApplicants.length;

        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = currentPage === totalPages;
    }

    let timelineChart, committeeChart, genderChart, yearChart;

function initializeCharts() {
    // Timeline Chart
    const timelineCtx = document.getElementById('timelineChart').getContext('2d');
    if (timelineChart instanceof Chart) {
        timelineChart.destroy();
    }
    timelineChart = new Chart(timelineCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Applications',
                data: [],
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    // Committee Chart
    const committeeCtx = document.getElementById('committeeChart').getContext('2d');
    if (committeeChart instanceof Chart) {
        committeeChart.destroy();
    }
    committeeChart = new Chart(committeeCtx, {
        type: 'doughnut',
        data: {
            labels: [],
            datasets: [{
                data: [],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(153, 102, 255, 0.8)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    // Gender Chart
    const genderCtx = document.getElementById('genderChart').getContext('2d');
    if (genderChart instanceof Chart) {
        genderChart.destroy();
    }
    genderChart = new Chart(genderCtx, {
        type: 'pie',
        data: {
            labels: [],
            datasets: [{
                data: [],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
// Faculty Chart
    const facultyCtx = document.getElementById('facultyChart').getContext('2d');
    facultyChart = new Chart(facultyCtx, {
        type: 'bar',
        data: {
            labels: [],
            datasets: [{
                label: 'Applicants',
                data: [],
                backgroundColor: 'rgba(153, 102, 255, 0.8)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });


    // Year Chart
    const yearCtx = document.getElementById('yearChart').getContext('2d');
    if (yearChart instanceof Chart) {
        yearChart.destroy();
    }
    yearChart = new Chart(yearCtx, {
        type: 'bar',
        data: {
            labels: [],
            datasets: [{
                label: 'Students',
                data: [],
                backgroundColor: 'rgba(75, 192, 192, 0.8)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

    function updateCharts() {
        // Update Timeline Chart
        if (!timelineChart || !committeeChart) {
        console.error('Charts are not initialized');
        return;
    }
        document.getElementById('timelineChart').classList.add('loading');
    document.getElementById('committeeChart').classList.add('loading');
        const applicationDates = filteredApplicants.map(a => a.applicationDate).sort();
        const dateCountMap = applicationDates.reduce((acc, date) => {
            acc[date] = (acc[date] || 0) + 1;
            return acc;
        }, {});

        timelineChart.data.labels = Object.keys(dateCountMap);
        timelineChart.data.datasets[0].data = Object.values(dateCountMap);
        timelineChart.update();
 // Update Faculty Chart
    const facultyCounts = filteredApplicants.reduce((acc, applicant) => {
        acc[applicant.faculty] = (acc[applicant.faculty] || 0) + 1;
        return acc;
    }, {});
    facultyChart.data.labels = Object.keys(facultyCounts);
    facultyChart.data.datasets[0].data = Object.values(facultyCounts);
    facultyChart.update();

   
        // Update Committee Chart
        const committeeCounts = filteredApplicants.reduce((acc, applicant) => {
            acc[applicant.committee] = (acc[applicant.committee] || 0) + 1;
            return acc;
        }, {});

        committeeChart.data.labels = Object.keys(committeeCounts);
        committeeChart.data.datasets[0].data = Object.values(committeeCounts);
        committeeChart.update();
        const genderCounts = filteredApplicants.reduce((acc, applicant) => {
        acc[applicant.gender] = (acc[applicant.gender] || 0) + 1;
        return acc;
    }, {});
    genderChart.data.labels = Object.keys(genderCounts);
    genderChart.data.datasets[0].data = Object.values(genderCounts);
    genderChart.update();

    // Update Year Chart
    const yearCounts = filteredApplicants.reduce((acc, applicant) => {
        acc[applicant.year] = (acc[applicant.year] || 0) + 1;
        return acc;
    }, {});
    yearChart.data.labels = Object.keys(yearCounts);
    yearChart.data.datasets[0].data = Object.values(yearCounts);
    yearChart.update();
    }
document.getElementById('applicantsTableBody').addEventListener('click', function(event) {
    if (event.target.classList.contains('view-profile-btn')) {
        const id = event.target.dataset.id;
        viewProfile(id);
    }
});
    function attachEventListeners() {
        document.getElementById('committeeFilter').addEventListener('change', handleFilterChange);
        document.getElementById('facultyFilter').addEventListener('change', handleFilterChange);
        document.getElementById('yearFilter').addEventListener('change', handleFilterChange);
        document.getElementById('searchInput').addEventListener('input', handleFilterChange);
        document.getElementById('prevPage').addEventListener('click', () => changePage(-1));
        document.getElementById('nextPage').addEventListener('click', () => changePage(1));
        document.getElementById('exportBtn').addEventListener('click', exportReport);
        document.getElementById('refreshBtn').addEventListener('click', fetchData);
        document.getElementById('closeModal').addEventListener('click', closeModal);
    }

    function handleFilterChange(event) {
        filters[event.target.id.replace('Filter', '').toLowerCase()] = event.target.value;
        currentPage = 1;
        updateDashboard();
    }

    function changePage(direction) {
        currentPage += direction;
        renderTable();
    }

    function viewProfile(id) {
    const applicant = applicants.find(a => a.id === id);
    if (!applicant) return;

    const modalContent = `
        <div class="bg-white rounded-lg p-6 max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800">${applicant.firstName} ${applicant.lastName}</h2>
                <span class="px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">
                    ${applicant.preferredCommittee}
                </span>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <p class="text-sm text-gray-600">Email</p>
                    <p class="font-medium">${applicant.email}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Phone</p>
                    <p class="font-medium">${applicant.phone}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Gender</p>
                    <p class="font-medium">${applicant.gender}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Date of Birth</p>
                    <p class="font-medium">${applicant.dob}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Faculty</p>
                    <p class="font-medium">${applicant.faculty}${applicant.otherFaculty ? ` - ${applicant.otherFaculty}` : ''}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Academic Year</p>
                    <p class="font-medium">${applicant.academicYear}</p>
                </div>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Skills & Experience</h3>
                <p>${applicant.skills}</p>
                <p class="mt-2">${applicant.experience}</p>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <h3 class="text-lg font-semibold mb-2">Social Media & Portfolio</h3>
                    <p><strong>Facebook:</strong> <a href="${applicant.facebook}" target="_blank" class="text-blue-600 hover:underline">${applicant.facebook}</a></p>
                    <p><strong>LinkedIn:</strong> <a href="${applicant.linkedin}" target="_blank" class="text-blue-600 hover:underline">${applicant.linkedin}</a></p>
                    <p><strong>Portfolio:</strong> <a href="${applicant.portfolio}" target="_blank" class="text-blue-600 hover:underline">${applicant.portfolio}</a></p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-2">Application Details</h3>
                    <p><strong>Submission Date:</strong> ${new Date(applicant.Timestamp).toLocaleString()}</p>
                </div>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-2">Committee-Specific Questions</h3>
                ${generateCommitteeQuestions(applicant)}
            </div>
        </div>
    `;

    modalContentEl.innerHTML = modalContent;
    applicantModal.classList.remove('hidden');
}

function generateCommitteeQuestions(applicant) {
    const committee = applicant.preferredCommittee.toLowerCase().replace(/\s+/g, '');
    const questions = [
        `${committee}Q1`,
        `${committee}Q2`,
        `${committee}Q3`
    ];

    return questions.map((q, index) => {
        if (applicant[q]) {
            return `
                <div class="mb-4">
                    <p class="font-semibold">Question ${index + 1}:</p>
                    <p>${applicant[q]}</p>
                </div>
            `;
        }
        return '';
    }).join('');
}

    function closeModal() {
        applicantModal.classList.add('hidden');
    }

    function exportReport() {
        const csvContent = [
            ['Name', 'Email', 'Committee', 'Faculty', 'Year', 'Status', 'Gender', 'Application Date'],
            ...filteredApplicants.map(a => [a.name, a.email, a.committee, a.faculty, a.year, a.status, a.gender, a.applicationDate])
        ].map(row => row.join(',')).join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'enactus_applicants_report.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }

    // Initial data fetch
    fetchData();
});
</script>
</body>
</html>
